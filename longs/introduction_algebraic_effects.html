<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="author" content="Xavier Van de Woestyne">
    
    
    <meta name="description" content="Tests unitaires de fonctions impures: Une introduction aux effets algébriques par le biais des tests unitaires.">
    
    <title>
      xvw - Tests unitaires de fonctions impures
      
      : Une introduction aux effets algébriques par le biais des tests unitaires.
      
    </title>
    <link rel="stylesheet" href="../css/fonts.css" />
    <link rel="stylesheet" href="../css/hl.css" />
    <link rel="stylesheet" href="../css/default.css" />
    <link rel="alternate" type="application/atom+xml" title="xvw-planet" href="../atom.xml" />
    <script src="../facade.bc.js"></script>
  </head>
  <body>
    <header>
      <div class="container">
        <div>
          <div class="header-bar">
            <h1>Xavier Van de Woestyne</h1>
            
            <h2>Tentative</h2>
            
          </div>
        </div>
      </div>
    </header>
    <main>
      <div class="navbar">
        <nav class="container">
          <a href="../">Accueil</a>
          <a href="../tags.html">Tags</a>
          <a href="../longs.html">Articles</a>
          <a href="../projects.html">Projets</a>
          <a href="../galleries.html">Galeries</a>
          <a href="../journal.html">Activité</a>
        </nav>
      </div>
      <div class="main-block">
        <div id="resume-details" class="page-small-cover black-block small-refutable"></div>
<div class="container base-content uniq-content">
  <div class="qexp-metadata" id="story-qexp-metadata">
    <textarea data-planet-qexp="story">(:permaname "introduction_algebraic_effects")
(:title "Tests unitaires de fonctions impures")
(:synopsis
  "Une introduction aux effets algébriques par le biais des tests unitaires.")
(:links ()) (:content "external" #org "content/posts/algebraic-effects.org")
(:published true) (:category "programmation")
(:tags ("programmation" "fonctionnelle" "pure" "effets algébriques" "test"))
(:date #020C05)
(:kind #long)</textarea>
  </div>

  <div class="content-page">
    <div class="major-header">
      <div class="major-details">
        <h1>Tests unitaires de fonctions impures</h1>
        <span class="synopsis">
          Une introduction aux effets algébriques par le biais des tests unitaires.
        </span>
        <div>
          <span class="badge published">2020-03-05</span>
          <span class="badge">programmation</span>
        </div>
      </div>
    </div>
    <div class="major-content">
      <div class="long-text structured-text" id="roe-container">
        <blockquote>
<p>La programmation fonctionnelle pure offre beaucoup de bénéfices. Elle n’utilise que des fonctions pures qui sont faciles à tester, facile à raisonner et qui permettent au compilateur de les optimiser.</p>
<p>Ce serait vraiment plus confortable de ne travailler qu’avec des fonctions pures, malheureusement, dans la construction de logiciels “utiles”, cela semble impossible. En effet <strong>les programmes du monde réel produisent des effets</strong>, il est donc, à priori, impossible de représenter un programme utile à coup de fonctions pures.</p>
<p>Dans ce très court article, je vous propose de découvrir <strong>les effets algébriques</strong> <strong>et leurs gestionnaires</strong> pour construire des programmes qui exécutent des effets, dans le contexte d’un langage de programmation fonctionnel (<a href="https://ocaml.org/">OCaml</a>), que l’on peut composer (pour construire des programmes plus complexes) tout en restant facilement testable unitairement.</p>
</blockquote>
<p>Cela fait très longtemps que l’importance des tests unitaires n’est plus remise en question. Ils permettent de garantir, au mieux, la non-régression de la base de code, mais aussi servir de spécification. Couplé avec des méthodes fines, comme par exemple, les tests dirigés par les propriétés, qui, sur base d’une collection d’invariants (les propriétés), génèrent une collection de tests “aléatoirement”. Il est donc nécéssaire de fournir un maximum de tests, clairs et facilement maintenable.</p>
<p>Concrètement, il est possible de facilement tester unitairement les <strong>fonctions</strong> <strong>pures</strong>, alors que les <strong>fonctions impures</strong> infligent généralement l’usage de <em>hacks</em> pour capturer l’essence de la fonctionnalité testée.</p>
<h2 id="fonctions-pures-et-impures">Fonctions pures et impures</h2>
<p>Dans un premier temps, observons cette fonction, implémentée en <strong>Kotlin</strong>, dont le rôle principal est de calculer le successeur d’un nombre :</p>
<div class="sourceCode" id="cb1" data-roe-kind="code" data-pellet="Kotlin" data-line-number="true"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">import</span> <span class="im">java.util.Scanner</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">fun</span> <span class="fu">successor</span>() {</a>
<a class="sourceLine" id="cb1-4" title="4">  <span class="kw">val</span> <span class="va">reader</span> = Scanner(System.`in`)</a>
<a class="sourceLine" id="cb1-5" title="5">  print(<span class="st">&quot;Enter a number: &quot;</span>)</a>
<a class="sourceLine" id="cb1-6" title="6">  <span class="kw">val</span> <span class="va">input</span> = reader.nextInt()</a>
<a class="sourceLine" id="cb1-7" title="7">  <span class="kw">val</span> <span class="va">result</span> = input + <span class="dv">1</span></a>
<a class="sourceLine" id="cb1-8" title="8">  println(<span class="st">&quot;The successor of [$input] is [$result] &quot;</span>)</a>
<a class="sourceLine" id="cb1-9" title="9">}</a>
<a class="sourceLine" id="cb1-10" title="10"></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">fun</span> <span class="fu">main</span>() {</a>
<a class="sourceLine" id="cb1-12" title="12">  successor()</a>
<a class="sourceLine" id="cb1-13" title="13">}</a></code></pre></div>
<p>Concrètement, cette fonction est potentiellement correct, cependant, elle pose, selon moi (et selon beaucoup de personne, probablement) énormément de soucis. Elle est impossible à tester unitairement facilement. En admettant que je voudrais tester cette fonction, je devrais capturer l’écriture sur <code class="sourceCode bash"><span class="ex">stdin</span></code> et l’écriture sur <code class="sourceCode bash"><span class="ex">stdout</span></code> pour être capable de fournir une collection de tests sur l’essence de mon algorithme, soit le fait que pour un nombre entier, je peux avoir son successeur. La fonction n’est pas pure, donc complexe à tester.</p>
<p>Une piste d’amélioration serait d’extraire l’essence du programme dans une fonction dédiée, dont le seul rôle serait de calculer le successeur d’un nombre entier. Par exemple :</p>
<div class="sourceCode" id="cb2" data-roe-kind="code" data-pellet="Kotlin" data-line-number="true"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">import</span> <span class="im">java.util.Scanner</span></a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">fun</span> <span class="fu">successor</span>(<span class="va">x</span>: <span class="dt">Int</span>) : <span class="dt">Int</span> {</a>
<a class="sourceLine" id="cb2-4" title="4">  <span class="kw">val</span> <span class="va">result</span> = x + <span class="dv">1</span></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="kw">return</span> result</a>
<a class="sourceLine" id="cb2-6" title="6">}</a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="kw">fun</span> <span class="fu">main</span>() {</a>
<a class="sourceLine" id="cb2-9" title="9">  <span class="kw">val</span> <span class="va">reader</span> = Scanner(System.`in`)</a>
<a class="sourceLine" id="cb2-10" title="10">  print(<span class="st">&quot;Enter a number: &quot;</span>)</a>
<a class="sourceLine" id="cb2-11" title="11">  <span class="kw">val</span> <span class="va">input</span> = reader.nextInt()</a>
<a class="sourceLine" id="cb2-12" title="12">  <span class="kw">val</span> <span class="va">result</span> = successor(input)</a>
<a class="sourceLine" id="cb2-13" title="13">  println(<span class="st">&quot;The successor of [$input] is [$result] &quot;</span>)</a>
<a class="sourceLine" id="cb2-14" title="14">}</a></code></pre></div>
<p>Cette amélioration est très naïve, mais elle représente tout de même une sacré pas en avant. La fonction <code class="sourceCode kotlin">successor(x)</code> est facilement testable, et ça tombe assez bien, car c’est elle qui est le coeur de notre programme.</p>
<p>Même s’il serait possible d’écrire un test unitaire pour la fonction <code class="sourceCode kotlin">main()</code> moyennant quelques tours de magie… est-ce réellement nécéssaire ? En effet, comme évoqué précédemment, l’essence de notre (discutablement intéressant) programme est de calculer un successeur pour un entier donné, et cette partie du programme est correctement testée, le reste du programme ne fait qu’exploiter des bibliothèques et des fonctions éprouvées de la <em>JVM</em> et, à l’instar des démonstrations mathématiques, qui visent à réduire une collection de propositions (qui forment l’hypothèse) à des axiomes, on ne cherche pas à tester ce qui a déjà été testé.</p>
        <div id="eof-page"></div>
      </div>
      <div class="content-rightbar">
        <div id="major-content-right" class="small-refutable">
          <div class="loading">
            <img src="../picto/loader.black.svg" alt="loading..." />
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="major-content-bottom">
    <div class="loading">
      <img src="../picto/loader.black.svg" alt="loading..." />
    </div>
  </div>
</div>
<script>
  planet.suspend(function() {
    planet.story.boot({
      path: "/longs/introduction_algebraic_effects.html",
      eof: document.getElementById("eof-page"),
      story: document.querySelector(
        "textarea[data-planet-qexp='story']"
      ),
      rightContainer: document.getElementById(
        "major-content-right"
      ),
      bottomContainer: document.getElementById(
        "major-content-bottom"
      ),
      resumeDetails: document.getElementById(
        "resume-details"
      )
    });
  });
  planet.suspend(function() {
    planet.roe.mount(
      document.getElementById("roe-container")
    );
  });
</script>

      </div>
    </main>
    <footer>
      <div class="container">
        <div class="left">
          <button id="random-page-btn" class="small-button-gray">
            Page aléatoire
          </button>
          <br /><br />
          Cette page est construite avec
          <a href="https://jaspervdj.be/hakyll/">Hakyll</a> et
          <a href="../projects/planet.html">Planet</a>.
          <br />
          Le contenu est distribué sous licence
          <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a>.
        </div>
        <div class="center">
          <a href="http://webring.xxiivv.com/#random" target="_blank">
            <img class="pictogram" src="../picto/webring.black.svg" alt="webring-logo" />
          </a>
        </div>
        <div class="right">
          <a href="../xavier.html">Xavier Van de Woestyne</a> ©<br />
          2017-2020
        </div>
      </div>
    </footer>
    <div id="planet-sectors-metadata">
      <span class="planet-metadata sector-data" data-name="programming" data-desc="Programmation (code) relative ou non à des projets" data-color="rgb(34, 34, 34)"><!-- Planet metadata --></span>
<span class="planet-metadata sector-data" data-name="visual" data-desc="Dessin/Peinture/Design" data-color="rgb(68, 68, 68)"><!-- Planet metadata --></span>
<span class="planet-metadata sector-data" data-name="audio" data-desc="Musique/Sound design" data-color="rgb(221, 221, 221)"><!-- Planet metadata --></span>
<span class="planet-metadata sector-data" data-name="writing" data-desc="Ecriture d'articles, de livres, de notes" data-color="rgb(136, 136, 136)"><!-- Planet metadata --></span>
<span class="planet-metadata sector-data" data-name="research" data-desc="Expériences variées liées à l'apprentissage" data-color="rgb(85, 85, 85)"><!-- Planet metadata --></span>
<span class="planet-metadata sector-data" data-name="maintenance" data-desc="Correctif, maintenance d'infrastructures" data-color="rgb(204, 204, 204)"><!-- Planet metadata --></span>
<span class="planet-metadata sector-data" data-name="reading" data-desc="Activité liées à la lecture" data-color="rgb(192, 192, 192)"><!-- Planet metadata --></span>

    </div>
    <script>
      planet.suspend(function() {
        planet.tags.random({
          button: document.getElementById('random-page-btn')
        });
      });
      planet.start();
    </script>
  </body>
</html>
